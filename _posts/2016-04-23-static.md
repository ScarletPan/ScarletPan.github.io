---
layout: post
title: Qt 静态编译
tags: Qt
comments: false
modifed: 2016-04-23
---

# 编译步骤


&emsp;&emsp;对于第一次接触静态编译的人来说，静态编译GUI工程的确是一项非常艰巨的任务，不过万幸，最终还是把我的[汇编器](https://github.com/ScarletPan/Mips-assembler)静态编译成功啦。

* 工具：QT creator 5.6.0 community 版本。
* 一些重要的依赖库：Qt5Core、Qt5Widgets等其他Qt库，以及C++的等标准库，Runtime库。

&emsp;&emsp;首先来讲一下静态编译的难点：由于Qt 5.6 涉及到版权问题，因此它并不给社区版的用户提供静态编译的条件，所有的 ** */include**  和 ** */lib** 里面的库文件都是通过动态链接dll使用户在本地项目编译并顺利运行，但如果想使自己的应用程序在其他没有相应依赖库环境条件下的电脑上跑（这里只涉及windows），一个方法是找到所有的相关文件（即.dll）打包到发布的.exe文件路径中，但是总是会有疏漏（或者说不能正常运行）， 而且每个.dll的文件都非常巨大,达到10M以上的级别，所以不是非常好，所以另一方法是静态编译，但是静态编译要求有预编译好的静态库，这些只是但从下载下来的Qt软件中是找不到的，下面说说我是怎么实现静态编译的。

&emsp;&emsp;由于在搜集方法的过程中很多人都只讲了如何静态编译Qt，而给出更明确的目标（如何静态发布自己的.exe）为了不让以后的自己或者看到这篇人多走弯路特地记录了以高效的方式静态编译的方法：

* 步骤一：安装minGW

&emsp;&emsp;总之我觉得懂编译的人对它应该都不陌生，对于不懂编译的孩子（比如我），只要知道它可以编译你的Qt程序，允许你在没有第三方动态链接库的情况下使用 GCC 产生 Windows32 程序。具体下载地址在[这里](https://sourceforge.net/projects/mingw/files/),注意的是如果嫌麻烦，就别戳进那些文件夹里去了，直接点 [Download mingw-get-setup.exe (86.5 kB)](https://sourceforge.net/projects/mingw/files/latest/download?source=files),exe安装帮你免去了配置各种环境的麻烦：) 安装时候据说最好选择最新版本，不过我自己的话选择的是4.9.2的

* 步骤二：取得Qt静态编译后的版本

&emsp;&emsp;法一：最简单也是最高效的方法，直接去Qt社区找，如果运气好的话是能找到自己相应Qt版本其他人静态编译好的成果，比如本次汇编器发布所用的静态Qt版本我是从[这里](http://www.qtcn.org/bbs/thread-htm-fid-68.html)找到的。

&emsp;&emsp;法二：很费时间也可能会出现一系列问题的方法，就是自己去用minGW静态编译，具体可以看一下[这篇博文](http://blog.csdn.net/wsj18808050/article/details/50909381)

&emsp;&emsp;法三：把人家弄好的虚拟机环境下载下来，在虚拟机里面编译。可以戳这个[链接](http://blog.csdn.net/wsj18808050/article/details/50935343)


* 步骤三：在Qt里面进行配置 

&emsp;&emsp;主要是人工建立静态编译环境，具体仍然可以参考上面的博文，我在这里贴上自己的配置（先戳进工具里面的选项一栏）：

&emsp;&emsp;![套件](http://ww1.sinaimg.cn/mw690/005INZAsgw1f36q1lbbhdj30rk0gq76c.jpg)
&emsp;&emsp;![版本](http://ww1.sinaimg.cn/mw690/005INZAsgw1f36q1lqnf9j30rk0gqabt.jpg)
&emsp;&emsp;![编译器](http://ww4.sinaimg.cn/mw690/005INZAsgw1f36q1mp5i0j30rk0gqdhx.jpg)
&emsp;&emsp;![Debug](http://ww2.sinaimg.cn/mw690/005INZAsgw1f36q1n8jzuj30rk0gqjt0.jpg)


* 步骤四：新建静态项目

&emsp;&emsp;这里只要注意一点点就行了，就是在建立项目的时候选择静态version:

&emsp;&emsp;![新建](http://ww2.sinaimg.cn/mw690/005INZAsgw1f36q1nrxqpj30p20cj0tb.jpg)
&emsp;&emsp;在这里有另一个值得注意的是：Debug的话最好在动态编译环境完成，因为静态编译出来的debug太大了，所以最后发布时候一定要以release的方式构建:)

* 步骤五：get .exe应用程序

&emsp;&emsp;最后你可以在release的文件夹中找到.exe文件，此时已经可以在别人家的电脑上运行了~

&emsp;&emsp;![汇编器](http://ww3.sinaimg.cn/mw690/005INZAsgw1f35qiiy7cjj30tg0ltn0f.jpg)

---

写在最后：静态编译千万别浪费时间在VS上调用QT了！这是个大坑：( 笔者就是因为这样才浪费了大把时间走了弯路。


